# frozen_string_literal: true

class VulnerabilityIssue
  include Mongoid::Document

  field :iid, type: Integer
  field :directory, type: String
  field :package, type: String
  field :package_ecosystem, type: String
  field :status, type: String, default: "opened"

  belongs_to :project
  belongs_to :vulnerability

  # Open vulnerability issues
  #
  # @param [String] package_ecosystem
  # @param [String] directory
  # @param [String] package
  # @return [Array<VulnerabilityIssue>]
  def self.open_vulnerability_issues(package_ecosystem:, directory:, package:)
    where(
      directory: directory,
      package: package,
      package_ecosystem: package_ecosystem,
      status: "opened"
    )
  end

  # Set vulnerability issue status to closed
  #
  # @return [void]
  def close
    update_attributes!(status: "closed")
  end
end
